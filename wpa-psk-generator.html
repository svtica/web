<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Cl√© WPA-PSK - Outils SysAdmin</title>
    
    <!-- CSS - Th√®mes -->
    <link rel="stylesheet" href="css/synthwave-dark.css">
    <link rel="stylesheet" href="css/light-theme.css">
    
    <!-- Theme Manager JavaScript -->
    <script src="js/theme-manager.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .info-section {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .info-section h3 {
            color: #1565c0;
            margin-top: 0;
        }
        
        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }
        
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus, input[type="password"]:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.3);
        }
        
        .generate-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        .generate-btn:hover {
            background: #5a6fd8;
        }
        
        .generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .result-section {
            background: #f1f8e9;
            border: 2px solid #8bc34a;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            display: none;
        }
        
        .result-section.show {
            display: block;
        }
        
        .psk-output {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            word-break: break-all;
            margin: 10px 0;
            min-height: 40px;
            line-height: 1.4;
        }
        
        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            padding: 3px;
            margin: 10px 0;
            display: none;
        }
        
        .progress-bar.show {
            display: block;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 20px;
            border-radius: 7px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .copy-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .copy-btn:hover {
            background: #45a049;
        }
        
        .security-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
        }
        
        .usage-examples {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .usage-examples h3 {
            color: #333;
            margin-top: 0;
        }
        
        .example {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .example strong {
            color: #667eea;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }
            
            .form-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê G√©n√©rateur de Cl√© WPA-PSK</h1>
        
        <div class="info-section">
            <h3>üìã √Ä propos de cet outil</h3>
            <p>Ce g√©n√©rateur calcule la cl√© pr√©-partag√©e (PSK) WPA √† partir d'une phrase de passe et d'un SSID. La cl√© r√©sultante de 256 bits est utilis√©e pour la d√©rivation de cl√© dans les r√©seaux Wi-Fi s√©curis√©s.</p>
            <p><strong>üîí S√©curit√© :</strong> Tous les calculs sont effectu√©s localement dans votre navigateur. Aucune information n'est transmise sur le r√©seau.</p>
        </div>
        
        <div class="form-section">
            <form id="pskForm">
                <div class="form-group">
                    <label for="passphrase">Phrase de passe WPA :</label>
                    <input type="password" id="passphrase" placeholder="Entrez votre phrase de passe WPA (8-63 caract√®res)" maxlength="63">
                    <div style="margin-top: 5px;">
                        <input type="checkbox" id="showPassphrase" onchange="togglePasswordVisibility()">
                        <label for="showPassphrase" style="display: inline; font-weight: normal; margin-left: 5px;">Afficher la phrase de passe</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="ssid">SSID du r√©seau :</label>
                    <input type="text" id="ssid" placeholder="Nom du r√©seau Wi-Fi" maxlength="32">
                </div>
                
                <button type="button" class="generate-btn" onclick="generatePSK()" id="generateBtn">
                    G√©n√©rer la cl√© PSK
                </button>
            </form>
        </div>
        
        <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill" style="width: 0%;">0%</div>
        </div>
        
        <div class="result-section" id="resultSection">
            <h3>üîë Cl√© PSK g√©n√©r√©e :</h3>
            <div class="psk-output" id="pskOutput">La cl√© appara√Ætra ici...</div>
            <button class="copy-btn" onclick="copyPSK()">üìã Copier la cl√©</button>
        </div>
        
        <div class="security-note">
            <strong>‚ö†Ô∏è Note de s√©curit√© :</strong> Conservez cette cl√© en lieu s√ªr. Elle donne acc√®s complet √† votre r√©seau Wi-Fi. Ne la partagez qu'avec des personnes de confiance.
        </div>
        
        <div class="usage-examples">
            <h3>üí° Exemples d'utilisation</h3>
            
            <div class="example">
                <strong>Configuration de routeur :</strong><br>
                Utilisez cette cl√© dans la configuration avanc√©e de votre routeur au lieu de la phrase de passe pour une authentification plus rapide.
            </div>
            
            <div class="example">
                <strong>Diagnostic r√©seau :</strong><br>
                V√©rifiez que vos appareils utilisent la m√™me cl√© PSK pour diagnostiquer les probl√®mes de connexion Wi-Fi.
            </div>
            
            <div class="example">
                <strong>Scripts d'automatisation :</strong><br>
                Int√©grez cette cl√© dans vos scripts de configuration r√©seau automatis√©e.
            </div>
        </div>
    </div>

    <script>
        // Fonction pour basculer la visibilit√© du mot de passe
        function togglePasswordVisibility() {
            const passphraseInput = document.getElementById('passphrase');
            const checkbox = document.getElementById('showPassphrase');
            
            passphraseInput.type = checkbox.checked ? 'text' : 'password';
        }
        
        // Fonction de validation des entr√©es
        function validateInputs() {
            const passphrase = document.getElementById('passphrase').value;
            const ssid = document.getElementById('ssid').value;
            const generateBtn = document.getElementById('generateBtn');
            
            // Reset des styles d'erreur
            document.getElementById('passphrase').style.borderColor = '#ddd';
            document.getElementById('ssid').style.borderColor = '#ddd';
            
            let isValid = true;
            let errorMessage = '';
            
            // Validation de la phrase de passe
            if (!passphrase) {
                errorMessage += 'La phrase de passe est obligatoire. ';
                document.getElementById('passphrase').style.borderColor = '#f44336';
                isValid = false;
            } else if (passphrase.length < 8 || passphrase.length > 63) {
                errorMessage += 'La phrase de passe doit contenir entre 8 et 63 caract√®res. ';
                document.getElementById('passphrase').style.borderColor = '#f44336';
                isValid = false;
            }
            
            // Validation du SSID
            if (!ssid) {
                errorMessage += 'Le SSID est obligatoire. ';
                document.getElementById('ssid').style.borderColor = '#f44336';
                isValid = false;
            } else if (ssid.length > 32) {
                errorMessage += 'Le SSID ne peut pas d√©passer 32 caract√®res. ';
                document.getElementById('ssid').style.borderColor = '#f44336';
                isValid = false;
            }
            
            // Mise √† jour du bouton
            generateBtn.disabled = !isValid;
            
            if (!isValid && errorMessage) {
                showError(errorMessage);
            }
            
            return isValid;
        }
        
        // Fonction pour afficher les erreurs
        function showError(message) {
            const pskOutput = document.getElementById('pskOutput');
            pskOutput.innerHTML = `<span style="color: #f44336;">‚ùå ${message}</span>`;
            document.getElementById('resultSection').classList.add('show');
        }
        
        // Fonction de mise √† jour de la barre de progression
        function updateProgress(percent) {
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            
            if (percent > 0) {
                progressBar.classList.add('show');
            }
            
            progressFill.style.width = percent + '%';
            progressFill.textContent = Math.round(percent) + '%';
            
            if (percent >= 100) {
                setTimeout(() => {
                    progressBar.classList.remove('show');
                }, 1000);
            }
        }
        
        // Fonction principale de g√©n√©ration PSK
        async function generatePSK() {
            if (!validateInputs()) {
                return;
            }
            
            const passphrase = document.getElementById('passphrase').value;
            const ssid = document.getElementById('ssid').value;
            const pskOutput = document.getElementById('pskOutput');
            const resultSection = document.getElementById('resultSection');
            
            // Affichage du d√©but du processus
            pskOutput.innerHTML = 'üîÑ G√©n√©ration de la cl√© PSK en cours...';
            resultSection.classList.add('show');
            updateProgress(10);
            
            try {
                // Simulation d'un processus de calcul progressif
                updateProgress(25);
                
                // Calcul de la cl√© PSK en utilisant PBKDF2
                const key = await calculatePBKDF2(passphrase, ssid, 4096, 32);
                
                updateProgress(90);
                
                // Conversion en format hexad√©cimal
                const hexKey = Array.from(new Uint8Array(key))
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
                
                updateProgress(100);
                
                // Affichage du r√©sultat
                pskOutput.innerHTML = `
                    <strong>Cl√© PSK (256 bits) :</strong><br>
                    <span style="font-size: 16px; color: #2e7d32;">${hexKey}</span><br><br>
                    <small><strong>SSID :</strong> ${ssid}</small><br>
                    <small><strong>Longueur :</strong> ${hexKey.length} caract√®res (${key.byteLength} bytes)</small><br>
                    <small><strong>Algorithme :</strong> PBKDF2-SHA1, 4096 it√©rations</small>
                `;
                
            } catch (error) {
                updateProgress(0);
                showError('Erreur lors de la g√©n√©ration de la cl√© : ' + error.message);
                console.error('Erreur PSK:', error);
            }
        }
        
        // Fonction PBKDF2 utilisant l'API Web Crypto
        async function calculatePBKDF2(password, salt, iterations, keyLength) {
            const encoder = new TextEncoder();
            const passwordBuffer = encoder.encode(password);
            const saltBuffer = encoder.encode(salt);
            
            // Import de la cl√©
            const keyMaterial = await crypto.subtle.importKey(
                'raw',
                passwordBuffer,
                { name: 'PBKDF2' },
                false,
                ['deriveBits']
            );
            
            // D√©rivation de la cl√©
            const derivedKey = await crypto.subtle.deriveBits(
                {
                    name: 'PBKDF2',
                    salt: saltBuffer,
                    iterations: iterations,
                    hash: 'SHA-1'
                },
                keyMaterial,
                keyLength * 8
            );
            
            return derivedKey;
        }
        
        // Fonction pour copier la cl√© dans le presse-papiers
        function copyPSK() {
            const pskOutput = document.getElementById('pskOutput');
            const textContent = pskOutput.textContent || pskOutput.innerText;
            
            // Extraction de la cl√© hexad√©cimale
            const hexMatch = textContent.match(/([0-9a-f]{64})/i);
            if (hexMatch) {
                const hexKey = hexMatch[1];
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(hexKey).then(() => {
                        showCopySuccess();
                    }).catch(err => {
                        fallbackCopyText(hexKey);
                    });
                } else {
                    fallbackCopyText(hexKey);
                }
            }
        }
        
        // Fonction de copie de secours
        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopySuccess();
            } catch (err) {
                alert('Impossible de copier automatiquement. Veuillez s√©lectionner et copier manuellement.');
            }
            
            document.body.removeChild(textArea);
        }
        
        // Fonction pour afficher le succ√®s de la copie
        function showCopySuccess() {
            const copyBtn = document.querySelector('.copy-btn');
            const originalText = copyBtn.textContent;
            copyBtn.textContent = '‚úÖ Copi√© !';
            copyBtn.style.background = '#4caf50';
            
            setTimeout(() => {
                copyBtn.textContent = originalText;
                copyBtn.style.background = '#4caf50';
            }, 2000);
        }
        
        // Validation en temps r√©el
        document.getElementById('passphrase').addEventListener('input', validateInputs);
        document.getElementById('ssid').addEventListener('input', validateInputs);
        
        // G√©n√©ration automatique en appuyant sur Entr√©e
        document.getElementById('passphrase').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generatePSK();
            }
        });
        
        document.getElementById('ssid').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generatePSK();
            }
        });
        
        // Validation initiale
        document.addEventListener('DOMContentLoaded', function() {
            validateInputs();
        });
    </script>
    
    <!-- Theme initialization -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (!localStorage.getItem('theme')) {
                localStorage.setItem('theme', 'dark');
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        });
    </script>
</body>
</html>